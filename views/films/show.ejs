<%- include('../partials/header') %>

<section id="show-page">
  
  <div class="card text-bg-dark">
    <img src="/images/soundtrack.jpg" class="card-img" alt="...">
    <div class="card-img-overlay">
      <h5 class="card-title">FILM</h5>
      <p class="card-text">
        
        <div>TITLE </div>
        <div><%= film.title %></div>
        <div>YEAR </div>
        <div><%= film.releaseYear %></div>
        <ul>
        <ul>
          <% if (user) { %>
            <button><a href='/films/<%= film._id %>/soundtracks/new'>Add Soundtrack</a></button>
          <% } %>
      
          <div class="card w-50">
            <div class="card-body">
              <h5 class="card-title">Card title</h5>
              <p class="card-text"> <div>Soundtracks:</div>
                <% soundtracks.forEach(function(s) { %>
                  <tr>
                    <td><%= s.albumTitle %></td>
                    <td><%= s.song %></td>
                    <td><%= s.artist %></td>
                  </tr>
                <% }); %></p>
              <a href="#" class="btn btn-primary">Button</a>
            </div>
          </div>
         
      
          <br><br><h2>Reviews</h2>
          <% if (film.reviews) { %>
            <table>
              <thead>
                <tr>
                  <th>User</th>
                  <th>Date</th>
                  <th>Review</th>
                  <th>Rating</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% let total = 0 %>
                <% film.reviews.forEach(function(r) { %>
                  <% total += r.rating %>
                  <tr>
                    <td class="review-user"><img alt="avatar" src="<%= r.userAvatar %>" referrerpolicy="no-referrer"> <%= r.userName %></td>
                    <td><%= r.createdAt.toLocaleDateString() %></td>
                    <td><%= r.content %></td>
                    <td><%= r.rating %></td>
                    <td>
                      <% if (user?._id.equals(r.user)) { %>
                        <form action="/reviews/<%= r._id %>?_method=DELETE" method="POST">
                          <button type="submit">X</button>
                        </form>
                      <% } %>
                    </td>
                  </tr>
                <% }); %>
                <tr>
                  <td colspan="2"></td>
                  <td>
                    <strong>
                      <%= (total / soundtrack.reviews).toFixed(1) %>
                    </strong>
                  </td>
                </tr>
              </tbody>
            </table>
          <% } else { %>
            <h5>No Reviews Yet</h5>
          <% } %></p>
      <p class="card-text"><small>Play Filmu again, Sam.</small></p>
    </div>
  </div>
  
  

  <%- include('../partials/footer') %>
